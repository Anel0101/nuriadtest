<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–£–†–ò–ê–î: –ë—Ä–µ–º—è –í—ã–±–æ—Ä–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-trust: #34d399; /* green */
            --color-prosperity: #fbbf24; /* yellow */
            --color-stability: #f87171; /* red */
            --color-freedom: #60a5fa; /* blue */
            --color-diamond: #22d3ee; /* cyan */
        }
        body {
            font-family: 'Inter', sans-serif;
            color: #e6e6fa; /* –°–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç */
            transition: background-color 0.5s;
            /* üöÄ –§–û–ù–û–í–´–ô –ö–û–°–ú–ò–ß–ï–°–ö–ò–ô –ü–ê–¢–¢–ï–†–ù */
            background-color: #121028; /* –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π */
            background-image: radial-gradient(circle at 10% 50%, rgba(34, 211, 238, 0.05) 1px, transparent 1px),
                              radial-gradient(circle at 90% 20%, rgba(96, 165, 250, 0.05) 1px, transparent 1px);
            background-size: 800px 800px;
        }

        /* üåü –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–í–ï–ß–ï–ù–ò–ï –¢–ï–ö–°–¢–ê */
        h1, h2, h3, .text-cyan-400 {
            text-shadow: 0 0 5px var(--color-diamond), 0 0 10px rgba(34, 211, 238, 0.5); 
        }

        .game-container-style {
            max-width: 1024px;
            padding: 0.75rem;
            margin: 1rem auto;
            min-height: calc(100vh - 2rem);
        }
        
        @media (min-width: 768px) {
            .game-container-style {
                padding: 1rem;
                margin: 2rem auto;
                min-height: calc(100vh - 4rem);
            }
        }
        .stat-bar { height: 8px; border-radius: 4px; transition: width 0.5s ease-in-out, background-color 0.5s; }
        .card { 
            background-color: #1e1b3d; 
            border: 1px solid #3d396a; 
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5); 
        }
        .btn-choice { 
            transition: all 0.2s;
            min-height: 44px; /* iOS touch target minimum */
        }
        .btn-choice:hover { 
            background-color: #2b2857; 
            transform: translateY(-1px); 
        }
        .btn-choice:active { 
            transform: translateY(0); 
            box-shadow: none; 
        }
        
        @media (max-width: 768px) {
            .btn-choice {
                min-height: 48px;
                padding: 1rem !important;
                margin-bottom: 0.5rem;
            }
        }
        .mayor-avatar { 
            width: 80px; 
            height: 80px; 
            border-radius: 50%; 
            object-fit: cover; 
            border: 3px solid #778899; 
            object-position: top;
        }
        
        @media (min-width: 768px) {
            .mayor-avatar {
                width: 100px;
                height: 100px;
                border: 4px solid #778899;
            }
        }
        .bg-gradient-nuriad { background: linear-gradient(145deg, #2c285f 0%, #1e1b3d 100%); }
       
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ò–Ω—Ç—Ä–æ-—ç–∫—Ä–∞–Ω–∞ */
        #intro-screen, #game-container {
            transition: opacity 0.5s ease-in-out;
        }
        .intro-content {
            background-color: rgba(30, 27, 61, 0.95);
            padding: 1.5rem;
            border-radius: 1rem;
            max-width: 700px;
            text-align: center;
            margin: 0 1rem;
        }
        
        @media (min-width: 768px) {
            .intro-content {
                padding: 2.5rem;
                margin: 0;
            }
        }
        .dim-text {
            color: #a0aec0;
        }
       
        /* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω (–ó–∞—Å—Ç–∞–≤–∫–∞) */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 1.5s ease-out;
            opacity: 1;
        }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #22d3ee;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* –°–¢–ò–õ–¨ –î–õ–Ø –ê–ù–ò–ú–ê–¶–ò–ò –ë–†–ò–õ–õ–ò–ê–ù–¢–û–í */
        @keyframes flash-red {
            0%, 100% { 
                /* –ü—Ä–∏–º–µ–Ω—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å–≤–µ—á–µ–Ω–∏—è –∫ img */
                filter: drop-shadow(0 0 5px var(--color-diamond)); 
                transform: scale(1); 
            }
            50% { 
                filter: drop-shadow(0 0 8px #f87171);
                transform: scale(1.1); 
            }
        }
        .diamond-flash {
            animation: flash-red 0.5s ease-in-out 2;
        }
       
        /* –°—Ç–∏–ª–∏ –¥–ª—è –í–∏–¥–µ–æ */
        /* –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –≤–∏–¥–µ–æ-–∫–æ–Ω—Ü–æ–≤–æ–∫, —á—Ç–æ–±—ã –æ–Ω–∏ –±—ã–ª–∏ –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
        .video-ending {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 95; /* –í—ã—à–µ –∏–≥—Ä—ã, –Ω–∏–∂–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
            background-color: black;
            display: none;
        }

        #intro-screen-content {
            z-index: 100;
        }

        /* üí´ –£–õ–£–ß–®–ï–ù–ò–ï 3: –ê–ù–ò–ú–ê–¶–ò–Ø –ü–û–Ø–í–õ–ï–ù–ò–Ø –ö–ê–†–¢–û–ß–ö–ò */
        .card-enter {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out 0.2s, transform 0.5s ease-out 0.2s;
        }

        .card-enter-active {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Mobile-specific optimizations */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }
            
            .text-xs { font-size: 0.65rem; }
            .text-sm { font-size: 0.8rem; }
            
            /* Ensure sufficient spacing between interactive elements */
            .space-y-4 > * + * {
                margin-top: 1.5rem;
            }
            
            /* Improve readability on small screens */
            .card {
                margin-bottom: 1rem;
            }
            
            /* Larger touch targets for important interactions */
            input, select {
                min-height: 44px;
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }
    </style>
</head>
<body class="min-h-screen">

<audio id="background-tension-audio" loop preload="auto">
    <source src="assets/audio/ticking_sound.mp3" type="audio/mp3"> 
    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ.
</audio>

<audio id="ending-music-audio" loop preload="auto">
    <source src="assets/audio/ending_theme.mp3" type="audio/mp3"> 
    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ.
</audio>

<video id="intro-video" class="video-ending" preload="auto" style="z-index: 90; display: none;">
    <source src="assets/video/intro_video.mp4" type="video/mp4">
    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
</video>

<video id="video-good-ending" class="video-ending" preload="auto" style="display: none;">
    <source src="assets/video/ending_good.mp4" type="video/mp4">
    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
</video>
<video id="video-bad-ending" class="video-ending" preload="auto" style="display: none;">
    <source src="assets/video/ending_bad.mp4" type="video/mp4">
    Your browser does not support video.
</video>


<div id="splash-screen">
    <h1 class="text-4xl font-extrabold text-indigo-400 mb-4">–ù–£–†–ò–ê–î</h1>
    <div class="loader mb-4"></div>
    <p class="text-gray-400">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–∏–∏...</p>
</div>

<button id="start-intro-button" onclick="startVideoAndAudio()"
        class="fixed inset-0 w-full h-full bg-black bg-opacity-90 text-white flex items-center justify-center text-3xl font-bold z-[101] transition-opacity duration-300 hidden">
    –ù–ê–ß–ê–¢–¨ (–ö–ª–∏–∫ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–∏–¥–µ–æ –∏ –∑–≤—É–∫–∞)
</button>
<div id="intro-screen" class="fixed inset-0 bg-cover bg-center flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none">
    <div class="intro-content" id="intro-screen-content">
        <h1 class="text-3xl md:text-5xl font-extrabold text-indigo-400 mb-4 md:mb-6" id="main-title">–ù–£–†–ò–ê–î: –ë—Ä–µ–º—è –í—ã–±–æ—Ä–∞</h1>
       
        <div id="intro-lore">
            <p class="text-base md:text-lg dim-text mb-4 text-left">
                –í —Ç–µ—á–µ–Ω–∏–µ —Å—Ç–æ–ª–µ—Ç–∏–π —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–æ –º–µ—á—Ç–∞–ª–æ –æ –≤—Ç–æ—Ä–æ–º —à–∞–Ω—Å–µ. –ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ó–µ–º–ª—è –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–∞—Å—å –≤ —Ç–æ–∫—Å–∏—á–Ω—É—é –ø—É—Å—Ç—ã–Ω—é, –Ω–∞—à –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–Ω—Å –æ–±–µ—Ä–Ω—É–ª—Å—è –ø—Ä–æ–µ–∫—Ç–æ–º ¬´–ö–æ–≤—á–µ–≥¬ª. –í—ã ‚Äî –æ–¥–∏–Ω –∏–∑ 50 000 –∫–æ–ª–æ–Ω–∏—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–∂–∏–ª–∏ –°–æ–Ω –∏ –ø—Ä–æ—Å–Ω—É–ª–∏—Å—å –Ω–∞ —ç—Ç–æ–º –Ω–æ–≤–æ–º, —Ö–æ–ª–æ–¥–Ω–æ–º, –Ω–æ –ø—Ä–∏–≥–æ–¥–Ω–æ–º –¥–ª—è –∂–∏–∑–Ω–∏ –∞–≤–∞–Ω–ø–æ—Å—Ç–µ.
            </p>
            <p class="text-base md:text-lg dim-text mb-6 text-left font-semibold">
                –≠—Ç–æ ‚Äî –ù—É—Ä–∏–∞–¥, —á—Ç–æ –Ω–∞ –¥—Ä–µ–≤–Ω–µ–º —è–∑—ã–∫–µ –æ–∑–Ω–∞—á–∞–µ—Ç ¬´–°–≤–µ—Ç¬ª.
            </p>
            <p class="text-base md:text-lg text-gray-200 mb-8 text-left">
                –ù–∞—à –∫—É–ø–æ–ª, –ì–æ—Ä–æ–¥ –ù–∞–¥–µ–∂–¥—ã, ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, —á—Ç–æ —Å—Ç–æ–∏—Ç –º–µ–∂–¥—É 50 —Ç—ã—Å—è—á–∞–º–∏ —á–µ–ª–æ–≤–µ–∫ –∏ –≤—Ä–∞–∂–¥–µ–±–Ω–æ–π –ø—É—Å—Ç–æ—Ç–æ–π. –í—ã ‚Äî –ú—ç—Ä, –≤—ã–±—Ä–∞–Ω–Ω—ã–π –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º. –ù–∞ –≤–∞—Å –ª–µ–∂–∏—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –∂–∏–∑–Ω—å –∫–∞–∂–¥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –∏ –±–∞–ª–∞–Ω—Å —á–µ—Ç—ã—Ä–µ—Ö —Å—Ç–æ–ª–ø–æ–≤. –£ –≤–∞—Å –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ 100 –ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤ –í–ª–∞—Å—Ç–∏.
            </p>

            <button onclick="showMayorDataForm()"
                    class="px-6 py-3 md:px-8 md:py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-bold transition duration-200 shadow-xl text-sm md:text-base">
                –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å 
            </button>
        </div>

        <div id="mayor-data-form" class="hidden">
           
            <div class="p-6 card rounded-lg mb-8 text-left">
                <h3 class="text-2xl font-semibold text-indigo-300 mb-4 text-center">–î–∞–Ω–Ω—ã–µ –ú—ç—Ä–∞</h3>
                <div class="space-y-4">
                    <div>
                        <label for="mayor-name" class="block text-sm font-medium text-gray-400">–ò–º—è:</label>
                        <input type="text" id="mayor-name" value="–ö–æ–ª–æ–Ω–∏—Å—Ç 101" class="mt-1 block w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 min-h-[44px] text-base" required>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="mayor-age" class="block text-sm font-medium text-gray-400">–í–æ–∑—Ä–∞—Å—Ç:</label>
                            <input type="number" id="mayor-age" value="35" min="18" max="100" class="mt-1 block w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 min-h-[44px] text-base" required>
                        </div>
                        <div>
                            <label for="mayor-gender" class="block text-sm font-medium text-gray-400">–ü–æ–ª:</label>
                            <select id="mayor-gender" class="mt-1 block w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 min-h-[44px] text-base">
                                <option value="–ù–µ —É–∫–∞–∑–∞–Ω">–ù–µ —É–∫–∞–∑–∞–Ω</option>
                                <option value="–ú—É–∂—Å–∫–æ–π">–ú—É–∂—Å–∫–æ–π</option>
                                <option value="–ñ–µ–Ω—Å–∫–∏–π">–ñ–µ–Ω—Å–∫–∏–π</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
           
            <button onclick="startSelection()"
                    class="px-6 py-3 md:px-8 md:py-3 bg-green-500 hover:bg-green-600 rounded-lg text-white font-bold transition duration-200 shadow-xl text-sm md:text-base">
                –ü—Ä–∏–Ω—è—Ç—å –ë—Ä–µ–º—è –∏ –ù–∞—á–∞—Ç—å
            </button>
        </div>
    </div>
</div>

<div id="game-container" class="game-container-style card rounded-xl hidden opacity-0">
   
    <div class="header mb-6 p-6 border-b border-gray-600/50">
        <h1 class="text-2xl md:text-4xl font-extrabold text-center text-indigo-300 mb-1">–ù–£–†–ò–ê–î</h1>
        <p class="text-center text-sm text-gray-400" id="game-stage">–≠—Ç–∞–ø: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</p>

        <div class="flex justify-center space-x-4 mt-4 mb-4">
            <button onclick="resetGame()" class="px-4 py-2 md:px-3 md:py-1 bg-red-600 hover:bg-red-700 rounded-lg text-white text-sm flex items-center shadow-md min-h-[44px] md:min-h-auto">
                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356-2A8.001 8.001 0 004.582 9m15.356 2A8.001 8.001 0 004.582 9m-1.5 5h.01M20 12h.01M16 12h.01M12 12h.01M8 12h.01M4 12h.01M4 16h.01M20 16h.01M16 16h.01M12 16h.01M8 16h.01M4 16h.01M4 20h.01M20 20h.01M16 20h.01M12 20h.01M8 20h.01M4 20h.01"></path></svg>
                –ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞ (Reset)
            </button>
        </div>
       
        <div id="stats-area" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-2 md:gap-4 mt-4 p-2 md:p-4 rounded-lg bg-gray-700/30">
            <div class="col-span-1 sm:col-span-2 md:col-span-1 flex items-center justify-center bg-gray-800/50 p-3 md:p-2 rounded-lg">
                <img id="diamond-icon" src="assets/images/diamond_icon.png" alt="Diamond" class="w-5 h-5 mr-1" />
                
                <span class="text-xl font-bold mr-2" style="color: var(--color-diamond)" id="diamond-count">
                    100
                </span>
                <span class="text-sm text-cyan-400">–ë–†–ò–õ–õ–ò–ê–ù–¢–û–í</span>
            </div>
           
            <div id="stat-trust" class="col-span-1 block">
                <p class="text-xs text-gray-400">–î–û–í–ï–†–ò–ï</p>
                <div class="w-full bg-gray-700 rounded-full mt-1">
                    <div id="bar-trust" class="stat-bar" style="width: 50%; background-color: var(--color-trust);"></div>
                </div>
            </div>
            <div id="stat-prosperity" class="col-span-1 block">
                <p class="text-xs text-gray-400">–ü–†–û–¶–í–ï–¢–ê–ù–ò–ï</p>
                <div class="w-full bg-gray-700 rounded-full mt-1">
                    <div id="bar-prosperity" class="stat-bar" style="width: 50%; background-color: var(--color-prosperity);"></div>
                </div>
            </div>
            <div id="stat-stability" class="col-span-1 block">
                <p class="text-xs text-gray-400">–°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–¨</p>
                <div class="w-full bg-gray-700 rounded-full mt-1">
                    <div id="bar-stability" class="stat-bar" style="width: 50%; background-color: var(--color-stability);"></div>
                </div>
            </div>
            <div id="stat-freedom" class="col-span-1 block">
                <p class="text-xs text-gray-400">–°–í–û–ë–û–î–ê</p>
                <div class="w-full bg-gray-700 rounded-full mt-1">
                    <div id="bar-freedom" class="stat-bar" style="width: 50%; background-color: var(--color-freedom);"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="main-content" class="p-6">
        <p class="text-center text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è...</p>
    </div>
   
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center p-4 z-50">
        <div class="card p-4 md:p-8 rounded-xl max-w-sm w-full text-center mx-4">
            <h3 class="text-xl md:text-2xl font-bold mb-4 text-red-400" id="modal-title">–û—à–∏–±–∫–∞!</h3>
            <p class="text-sm md:text-base text-gray-300 mb-6" id="modal-message">–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.</p>
            <button onclick="closeModal()" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-semibold min-h-[44px] w-full md:w-auto" id="modal-close-button">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

</div>

<div class="text-center text-gray-500 text-xs p-4 mt-8">
    <p>–§–æ–Ω–æ–≤—ã–π –∑–≤—É–∫: "Echoing Clock Tick" –æ—Ç Everyday Cinematic Sounds. –§–∏–Ω–∞–ª—å–Ω–∞—è –º–µ–ª–æ–¥–∏—è: [–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π –º–µ–ª–æ–¥–∏–∏]. (–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ —É—Å–ª–æ–≤–∏—è–º Royalty-Free).</p>
</div>

<script>
    // =============================================
    // üìä –ù–û–í–´–ô URL –ë–ê–ó–´ –î–ê–ù–ù–´–•
    // =============================================
    const GS_URL = "https://script.google.com/macros/s/AKfycbwA63iKrnqyBb3ksfCMjDfgY_yo9M3PlaMbzh9NgAAINWnQ6tDJpzGu7bJsVXsR_q0WWQ/exec";
    
    // –ì–ï–ù–ï–†–ê–¶–ò–Ø –£–ù–ò–ö–ê–õ–¨–ù–û–ì–û ID –°–ï–°–°–ò–ò
    const SESSION_ID = 'NURIAD_' + Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
    
    const DEFAULT_GAME_STATE = {
        mayorName: null,
        mayorAge: null,  
        mayorGender: null,
        mayorIdeology: null,
        diamonds: 100, // –°–¢–ê–†–¢
        trust: 50,
        prosperity: 50,
        stability: 50,
        freedom: 50,
        dilemmaIndex: 0, // 0 - –ò–Ω—Ç—Ä–æ, 1 - –í—ã–±–æ—Ä –ú—ç—Ä–∞, 2-11 - –î–∏–ª–µ–º–º—ã
        decisionCount: 0,
        expensiveChoices: 0,
        bonusesReceived: 0,
        playStartTime: Date.now() 
    };

    const EXPENSIVE_COST_MULTIPLIER = 1.25;
    const SLOW_TRUST_MULTIPLIER = 0.9;
    const OPTIMAL_BONUS = 5;
    const STATS = ['trust', 'prosperity', 'stability', 'freedom'];

    let GAME_STATE = { ...DEFAULT_GAME_STATE };
    let isUpdatingUI = false;

    // üîä –°—Å—ã–ª–∫–∏ –Ω–∞ –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ—ç–ª–µ–º–µ–Ω—Ç—ã
    const backgroundTensionAudio = document.getElementById('background-tension-audio');
    const endingMusicAudio = document.getElementById('ending-music-audio'); 
    const introVideo = document.getElementById('intro-video');
    const videoGoodEnding = document.getElementById('video-good-ending');
    const videoBadEnding = document.getElementById('video-bad-ending');
    const startIntroButton = document.getElementById('start-intro-button');

    // =============================================
    // üìä –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–û–•–†–ê–ù–ï–ù–ò–Ø –î–ê–ù–ù–´–• –í –ë–î
    // =============================================

    async function saveData(sheet, data) {
        // –ï—Å–ª–∏ URL –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
        if (!GS_URL) {
            console.log(`[DB] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ - –Ω–µ—Ç URL`);
            return;
        }
        
        console.log(`[DB] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–∏—Å—Ç '${sheet}' —Å –¥–∞–Ω–Ω—ã–º–∏:`, data);
        
        const payload = {
            sheet: sheet,
            data: {
                session_id: SESSION_ID,
                timestamp: new Date().toISOString(),
                ...data
            }
        };
        
        console.log(`[DB] –ü–æ–ª–Ω—ã–π payload:`, payload);

        try {
            // –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∫ FormData (–ª—É—á—à–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Google Apps Script)
            const formData = new FormData();
            formData.append('data', JSON.stringify(payload));
            
            const response = await fetch(GS_URL, {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                const result = await response.text();
                console.log(`[DB] –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ ${sheet}:`, result);
            } else {
                console.warn(`[DB] –û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è ${sheet}:`, response.status, response.statusText);
            }
            
        } catch (error) {
            console.error(`[DB] –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ ${sheet}:`, error);
            
            // Fallback: –ø—Ä–æ–±—É–µ–º no-cors —Ä–µ–∂–∏–º
            try {
                await fetch(GS_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'text/plain;charset=UTF-8',
                    },
                    body: JSON.stringify(payload)
                });
                console.log(`[DB] –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ ${sheet} (no-cors fallback)`);
            } catch (fallbackError) {
                console.error(`[DB] –ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞ –¥–ª—è ${sheet}:`, fallbackError);
            }
        }
    }

    // =============================================
    // üéÆ –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê (–°–û–•–†–ê–ù–ï–ù–ê –ü–û–õ–ù–û–°–¢–¨–Æ)
    // =============================================
   
    window.resetGame = function() {
        GAME_STATE = { ...DEFAULT_GAME_STATE };
        renderIntroScreen();
        showModal("–ù–∞—á–∞–ª–æ –°–Ω–∞—á–∞–ª–∞", "–ò–≥—Ä–∞ –±—ã–ª–∞ —Å–±—Ä–æ—à–µ–Ω–∞ –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é. –í–∞—à–∏ –ë—Ä–∏–ª–ª–∏–∞–Ω—Ç—ã: 100.");
        
        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ–¥–∏–∞
        if (backgroundTensionAudio) backgroundTensionAudio.pause(); 
        if (endingMusicAudio) endingMusicAudio.pause(); 
        [introVideo, videoGoodEnding, videoBadEnding].forEach(v => {
            if (v) {
                v.style.display = 'none';
                v.pause();
                v.currentTime = 0;
            }
        });
        if (startIntroButton) startIntroButton.classList.add('hidden'); // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É
    }
   
    async function saveGameState() {
        return Promise.resolve();
    }

    // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´ ---

    const MAYOR_PLATFORMS = {
        '–ì—É–º–∞–Ω–∏–∑–º': {
            name: '–î-—Ä –ê—Ä—å—è –®–∞—Ä–º–∞',
            image: 'assets/images/arya_sharma.jpg',
            bonus: { trust: 20 },
            malus: "–°—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö —Ä–µ—à–µ–Ω–∏–π –≤—ã—à–µ –Ω–∞ 25% –ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤.",
        },
        '–ê–≤—Ç–æ—Ä–∏—Ç–∞—Ä–∏–∑–º': {
            name: '–ì–µ–Ω–µ—Ä–∞–ª –ú–∞—Ä–∫ –¢–æ—Ä–Ω',
            image: 'assets/images/mark_thorn.jpg',
            bonus: { stability: 20 },
            malus: "–ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –°–≤–æ–±–æ–¥—ã —Å–Ω–∏–∂–µ–Ω–æ –Ω–∞ 15%.",
        },
        '–¢–µ—Ö–Ω–æ–∫—Ä–∞—Ç–∏—è': {
            name: '–ü—Ä–æ—Ñ. –õ–∏ –ß–µ–Ω',
            image: 'assets/images/lee_chen.jpg',
            bonus: { prosperity: 24 }, // –£–≤–µ–ª–∏—á–∏–ª –±–æ–Ω—É—Å –¥–ª—è —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è
            malus: "–ë–æ–Ω—É—Å—ã –∫ –î–æ–≤–µ—Ä–∏—é, –ø–æ–ª—É—á–∞–µ–º—ã–µ –æ—Ç —Ä–µ—à–µ–Ω–∏–π, —Å–Ω–∏–∂–µ–Ω—ã –Ω–∞ 10%.",
        }
    };

    const DILEMMAS = [
        {}, {}, // –ò–Ω–¥–µ–∫—Å—ã 0 –∏ 1 –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –¥–∏–ª–µ–º–º
       
        { // –ò–Ω–¥–µ–∫—Å 2 (–î–∏–ª–µ–º–º–∞ 1)
            id: "D2_WaterCrisis",
            title: "–î–ò–õ–ï–ú–ú–ê 1: –ö–†–ò–ó–ò–° –ß–ò–°–¢–û–ô –í–û–î–´",
            description: "–í—ã—à–µ–ª –∏–∑ —Å—Ç—Ä–æ—è –∫–ª—é—á–µ–≤–æ–π —Ñ–∏–ª—å—Ç—Ä. –†–µ–∑–µ—Ä–≤—ã –≤–æ–¥—ã –ø–∞–¥–∞—é—Ç –¥–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è. –ù–∞—á–∞–ª–∏—Å—å —Å—Ç—ã—á–∫–∏ –∑–∞ –≤–æ–¥—É. –ö–∞–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–µ—Å—É—Ä—Å –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø–∞–Ω–∏–∫—É?",
            choices: [
                { id: 'A', text: "–ß—Ä–µ–∑–≤—ã—á–∞–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ: –í–æ–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –∫–æ–º–µ–Ω–¥–∞–Ω—Ç—Å–∫–∏–π —á–∞—Å. (–†–∏—Å–∫ –î–æ–≤–µ—Ä–∏—è –∏ –°–≤–æ–±–æ–¥—ã)", cost: 5, effects: { trust: -20, stability: 25, freedom: -15 }, isOptimal: false },
                { id: 'B', text: "–ù–∞—Ä–æ–¥–Ω–æ–µ –æ–ø–æ–ª—á–µ–Ω–∏–µ: –ü—É–±–ª–∏—á–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ, –≤–æ–ª–æ–Ω—Ç–µ—Ä—ã –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –æ—á–µ—Ä–µ–¥–µ–π. (–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ)", cost: 15, effects: { trust: 15, prosperity: -10, stability: 5, freedom: 10 }, isOptimal: false },
                { id: 'C', text: "–£–¥–∞—Ä–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞: –ü–µ—Ä–µ–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —ç–Ω–µ—Ä–≥–∏—é –Ω–∞ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Ñ–∏–ª—å—Ç—Ä—ã, —Ä–∏—Å–∫—É—è –ø–æ–ª–æ–º–∫–æ–π –≤—Ç–æ—Ä–æ–≥–æ. (–û–ø—Ç–∏–º–∞–ª—å–Ω–æ)", cost: 25, effects: { trust: 10, prosperity: 15, stability: -10, freedom: 0 }, isOptimal: true }, // –û–ü–¢–ò–ú–ê–õ–¨–ù–û - –î–û–†–û–ì–û
            ]
        },
        { // –ò–Ω–¥–µ–∫—Å 3 (–î–∏–ª–µ–º–º–∞ 2)
            id: "D3_EnergyShortage",
            title: "–î–ò–õ–ï–ú–ú–ê 2: –≠–ù–ï–†–ì–ï–¢–ò–ß–ï–°–ö–ò–ô –î–ï–§–ò–¶–ò–¢",
            description: "–ö–ª—é—á–µ–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–µ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–∑–æ–≤–µ—Ç –¥–µ—Ñ–∏—Ü–∏—Ç —ç–Ω–µ—Ä–≥–∏–∏ –≤ –∂–∏–ª—ã—Ö —Å–µ–∫—Ç–æ—Ä–∞—Ö –Ω–∞ 72 —á–∞—Å–∞.",
            choices: [
                { id: 'A', text: "–í–≤–µ—Å—Ç–∏ –Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ: –û—Ç–∫–ª—é—á–∏—Ç—å –ø–∏—Ç–∞–Ω–∏–µ –≤ –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–æ–Ω–∞—Ö (—à–∫–æ–ª—ã, –ø–∞—Ä–∫–∏). (–î–µ—à–µ–≤–æ/–†–∏—Å–∫–æ–≤–∞–Ω–Ω–æ)", cost: 0, effects: { trust: -10, prosperity: 15, stability: 5, freedom: -10 }, isOptimal: false },
                { id: 'B', text: "–û–±—ä—è–≤–∏—Ç—å —Å–±–æ—Ä —Å—Ä–µ–¥—Å—Ç–≤: –ü–æ–ø—Ä–æ—Å–∏—Ç—å –±–æ–≥–∞—Ç—ã–µ —Å–µ–∫—Ç–æ—Ä—ã –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å —ç–Ω–µ—Ä–≥–∏—é. (–û–ø—Ç–∏–º–∞–ª—å–Ω–æ)", cost: 20, effects: { trust: 15, prosperity: -15, stability: 0, freedom: 15 }, isOptimal: true }, // –û–ü–¢–ò–ú–ê–õ–¨–ù–û - –î–û–†–û–ì–û
                { id: 'C', text: "–û—Ç–ª–æ–∂–∏—Ç—å —Ä–µ–º–æ–Ω—Ç: –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ 50% –º–æ—â–Ω–æ—Å—Ç–∏. (–†–∏—Å–∫ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)", cost: 10, effects: { trust: 5, prosperity: 5, stability: -20, freedom: 0 }, isOptimal: false },
            ]
        },
        { // –ò–Ω–¥–µ–∫—Å 4 (–î–∏–ª–µ–º–º–∞ 3)
            id: "D4_AlienArtifact",
            title: "–î–ò–õ–ï–ú–ú–ê 3: –ò–ù–û–ü–õ–ê–ù–ï–¢–ù–´–ô –ê–†–¢–ï–§–ê–ö–¢",
            description: "–û–±–Ω–∞—Ä—É–∂–µ–Ω –¥—Ä–µ–≤–Ω–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç. –£—á–µ–Ω—ã–µ —Ö–æ—Ç—è—Ç –∏–∑—É—á–∏—Ç—å –µ–≥–æ –≤ –≥–ª–∞–≤–Ω–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ (—Ä–∏—Å–∫). –í–æ–µ–Ω–Ω—ã–µ —Ö–æ—Ç—è—Ç –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –µ–≥–æ –≤ –æ—Ö—Ä–∞–Ω—è–µ–º—ã–π –±—É–Ω–∫–µ—Ä (–¥–æ—Ä–æ–≥–æ).",
            choices: [
                { id: 'A', text: "–í–æ–µ–Ω–Ω—ã–π –±—É–Ω–∫–µ—Ä: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –±—É–Ω–∫–µ—Ä, –Ω–∞–Ω—è–≤ –¥–æ–ø. –æ—Ö—Ä–∞–Ω—É. (–î–æ—Ä–æ–≥–æ–π, —Å—Ç–∞–±–∏–ª—å–Ω—ã–π)", cost: 28, effects: { trust: -5, prosperity: -10, stability: 20, freedom: -5 }, isOptimal: true }, // –û–ü–¢–ò–ú–ê–õ–¨–ù–û - –î–û–†–û–ì–û
                { id: 'B', text: "–ì–ª–∞–≤–Ω–∞—è –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è: –ò–∑—É—á–∞—Ç—å –Ω–∞ –º–µ—Å—Ç–µ, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø. (–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫/—Ü–µ–Ω–∞)", cost: 12, effects: { trust: -15, prosperity: 25, stability: 0, freedom: -10 }, isOptimal: false },
                { id: 'C', text: "–ó–∞–∫—Ä—ã—Ç—å: –ó–∞—Ö–æ—Ä–æ–Ω–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –∏ –æ–±—ä—è–≤–∏—Ç—å, —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. (–î–µ—à–µ–≤—ã–π, –Ω–æ –ø–æ—Ç–µ—Ä—è –ü—Ä–æ—Ü–≤–µ—Ç–∞–Ω–∏—è)", cost: 3, effects: { trust: 15, prosperity: -20, stability: 5, freedom: 5 }, isOptimal: false },
            ]
        },
        { // –ò–Ω–¥–µ–∫—Å 5 (–î–∏–ª–µ–º–º–∞ 4)
            id: "D5_PopulationGrowth",
            title: "–î–ò–õ–ï–ú–ú–ê 4: –†–û–°–¢ –ù–ê–°–ï–õ–ï–ù–ò–Ø",
            description: "–†–æ—Å—Ç –Ω–∞—Å–µ–ª–µ–Ω–∏—è –ø—Ä–µ–≤—ã—Å–∏–ª –ø—Ä–æ–≥–Ω–æ–∑—ã, –∫—É–ø–æ–ª—É –≥—Ä–æ–∑–∏—Ç –ø–µ—Ä–µ–Ω–∞—Å–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 –ª–µ—Ç. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—è—Ç—å –º–µ—Ä—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–æ–∂–¥–∞–µ–º–æ—Å—Ç–∏ –∏–ª–∏ –±—ã—Å—Ç—Ä–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –∂–∏–ª—ã–µ –∑–æ–Ω—ã.",
            choices: [
                { id: 'A', text: "–ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–æ–∂–¥–∞–µ–º–æ—Å—Ç–∏: –í–≤–µ—Å—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º—É '–û–¥–Ω–∞ –°–µ–º—å—è - –û–¥–∏–Ω –†–µ–±–µ–Ω–æ–∫'. (–î–µ—à–µ–≤—ã–π, –Ω–æ —Ç–æ—Ç–∞–ª–∏—Ç–∞—Ä–Ω—ã–π)", cost: 10, effects: { trust: -20, prosperity: 10, stability: 20, freedom: -25 }, isOptimal: false },
                { id: 'B', text: "–°—Ç–∏–º—É–ª—è—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏: –û—Ç–∫—Ä—ã—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Å–µ–∫—Ç–æ—Ä—ã –¥–ª—è –¥–æ–±—Ä–æ–≤–æ–ª—å—Ü–µ–≤. (–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞)", cost: 18, effects: { trust: 10, prosperity: -10, stability: -15, freedom: 15 }, isOptimal: false },
                { id: 'C', text: "–£—Å–∫–æ—Ä–µ–Ω–Ω–æ–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ: –í–ª–æ–∂–∏—Ç—å –≤—Å–µ —Ä–µ–∑–µ—Ä–≤—ã –≤ –Ω–æ–≤—ã–µ –∂–∏–ª—ã–µ –±–ª–æ–∫–∏. (–û–ø—Ç–∏–º–∞–ª—å–Ω–æ, –Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ—Ä–æ–≥–æ)", cost: 30, effects: { trust: 5, prosperity: -30, stability: 10, freedom: 0 }, isOptimal: true }, // –û–ü–¢–ò–ú–ê–õ–¨–ù–û - –î–û–†–û–ì–û
            ]
        },
        { // –ò–Ω–¥–µ–∫—Å 6 (–î–∏–ª–µ–º–º–∞ 5)
            id: "D6_DataBreach",
            title: "–î–ò–õ–ï–ú–ú–ê 5: –£–¢–ï–ß–ö–ê –î–ê–ù–ù–´–•",
            description: "–ö—Ä—É–ø–Ω–∞—è —É—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞—Å–∫—Ä—ã–ª–∞ –ª–∏—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –ù–∞—Å–µ–ª–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –Ω–∞–∫–∞–∑–∞–Ω–∏—è –≤–∏–Ω–æ–≤–Ω—ã—Ö (IT-–æ—Ç–¥–µ–ª–∞).",
            choices: [
                { id: 'A', text: "–ü—É–±–ª–∏—á–Ω–æ–µ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ: –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–æ —É–≤–æ–ª–∏—Ç—å –≥–ª–∞–≤—É IT-–æ—Ç–¥–µ–ª–∞. (–î–µ—à–µ–≤–æ, –ø–æ–ø—É–ª–∏–∑–º)", cost: 0, effects: { trust: 20, prosperity: -10, stability: 0, freedom: -5 }, isOptimal: false },
                { id: 'B', text: "–°–∫—Ä—ã—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç: –û–±—ä—è–≤–∏—Ç—å, —á—Ç–æ –∞—Ç–∞–∫–∞ –±—ã–ª–∞ –æ—Ç—Ä–∞–∂–µ–Ω–∞. (–†–∏—Å–∫)", cost: 10, effects: { trust: -30, prosperity: 15, stability: 15, freedom: 0 }, isOptimal: false },
                { id: 'C', text: "–ü—Ä–æ–∑—Ä–∞—á–Ω–æ–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: –û–±—ä—è–≤–∏—Ç—å –æ –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ, –ø—Ä–∏–≤–ª–µ–∫–∞—è –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∏—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤. (–û–ø—Ç–∏–º–∞–ª—å–Ω–æ)", cost: 22, effects: { trust: 15, prosperity: 5, stability: -5, freedom: 10 }, isOptimal: true }, // –û–ü–¢–ò–ú–ê–õ–¨–ù–û - –î–û–†–û–ì–û
            ]
        },
        { // –ò–Ω–¥–µ–∫—Å 7 (–î–∏–ª–µ–º–º–∞ 6)
            id: "D7_ResourceTrade",
            title: "–î–ò–õ–ï–ú–ú–ê 6: –¢–û–†–ì–û–í–õ–Ø –†–ï–°–£–†–°–ê–ú–ò",
            description: "–í–Ω–µ—à–Ω—è—è –∫–æ–ª–æ–Ω–∏—è –ø—Ä–æ—Å–∏—Ç –æ–±–º–µ–Ω—è—Ç—å –∏—Ö –∏–∑–±—ã—Ç–æ–∫ –º–µ–¥–∏ (—Ü–µ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å) –Ω–∞ –ø–æ–ª–æ–≤–∏–Ω—É –Ω–∞—à–∏—Ö –∑–∞–ø–∞—Å–æ–≤ –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è. –≠—Ç–æ –æ—á–µ–Ω—å –≤—ã–≥–æ–¥–Ω–æ, –Ω–æ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ.",
            choices: [
                { id: 'A', text: "–°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è: –°–æ–≤–µ—Ä—à–∏—Ç—å —Å–¥–µ–ª–∫—É. (–û–ø—Ç–∏–º–∞–ª—å–Ω–æ, –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫)", cost: 25, effects: { trust: 10, prosperity: 30, stability: -10, freedom: 0 }, isOptimal: true }, // –û–ü–¢–ò–ú–ê–õ–¨–ù–û - –î–û–†–û–ì–û
                { id: 'B', text: "–û—Ç–∫–∞–∑–∞—Ç—å—Å—è: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∞—Å—ã –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è. (–î–µ—à–µ–≤–æ/–ë–µ–∑–æ–ø–∞—Å–Ω–æ)", cost: 5, effects: { trust: 5, prosperity: -15, stability: 5, freedom: 0 }, isOptimal: false },
                { id: 'C', text: "–ü–æ—Å—Ä–µ–¥–Ω–∏–∫: –ü—Ä–∏–≤–ª–µ—á—å —Ç—Ä–µ—Ç—å—é —Å—Ç–æ—Ä–æ–Ω—É –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Å–¥–µ–ª–∫–∏. (–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞)", cost: 15, effects: { trust: 0, prosperity: -5, stability: 10, freedom: 5 }, isOptimal: false },
            ]
        },
        { // –ò–Ω–¥–µ–∫—Å 8 (–î–∏–ª–µ–º–º–∞ 7)
            id: "D8_ArtVsTech",
            title: "–î–ò–õ–ï–ú–ú–ê 7: –ò–°–ö–£–°–°–¢–í–û –ü–†–û–¢–ò–í –¢–ï–•–ù–û–õ–û–ì–ò–ô",
            description: "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –±—é–¥–∂–µ—Ç: –ª–∏–±–æ –Ω–∞ –ù–∞—É—á–Ω—É—é –ê–∫–∞–¥–µ–º–∏—é, –ª–∏–±–æ –Ω–∞ –¶–µ–Ω—Ç—Ä –ö—É–ª—å—Ç—É—Ä—ã –∏ –ò—Å–∫—É—Å—Å—Ç–≤.",
            choices: [
                { id: 'A', text: "–°–æ–∫—Ä–∞—Ç–∏—Ç—å –Ω–∞—É–∫—É: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫—É–ª—å—Ç—É—Ä—É. (–î–µ—à–µ–≤–æ, —Ä–∏—Å–∫ –¥–ª—è –ü—Ä–æ—Ü–≤–µ—Ç–∞–Ω–∏—è)", cost: 5, effects: { trust: 10, prosperity: -25, stability: 5, freedom: 15 }, isOptimal: false },
                { id: 'B', text: "–°–æ–∫—Ä–∞—Ç–∏—Ç—å –∫—É–ª—å—Ç—É—Ä—É: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—É–∫—É. (–†–∏—Å–∫ –¥–ª—è –î–æ–≤–µ—Ä–∏—è –∏ –°–≤–æ–±–æ–¥—ã)", cost: 15, effects: { trust: -15, prosperity: 20, stability: 5, freedom: -10 }, isOptimal: false },
                { id: 'C', text: "–†–∞–∑–¥–µ–ª–∏—Ç—å: –°–æ–∫—Ä–∞—Ç–∏—Ç—å –æ–±–∞ –±—é–¥–∂–µ—Ç–∞ –Ω–∞–ø–æ–ª–æ–≤–∏–Ω—É. (–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∫–æ–º–ø—Ä–æ–º–∏—Å—Å)", cost: 28, effects: { trust: 5, prosperity: -10, stability: 0, freedom: 5 }, isOptimal: true }, // –û–ü–¢–ò–ú–ê–õ–¨–ù–û - –î–û–†–û–ì–û
            ]
        },
        { // –ò–Ω–¥–µ–∫—Å 9 (–î–∏–ª–µ–º–º–∞ 8)
            id: "D9_Quarantine",
            title: "–î–ò–õ–ï–ú–ú–ê 8: –ö–ê–†–ê–ù–¢–ò–ù",
            description: "–í –æ–¥–Ω–æ–º –∏–∑ –∂–∏–ª—ã—Ö —Å–µ–∫—Ç–æ—Ä–æ–≤ –æ–±–Ω–∞—Ä—É–∂–µ–Ω –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –≤–∏—Ä—É—Å. –ù–µ–æ–±—Ö–æ–¥–∏–º —Å—Ç—Ä–æ–≥–∏–π –∫–∞—Ä–∞–Ω—Ç–∏–Ω, —á—Ç–æ –Ω–∞—Ä—É—à–∏—Ç –°–≤–æ–±–æ–¥—É 5000 –≥—Ä–∞–∂–¥–∞–Ω.",
            choices: [
                { id: 'A', text: "–°—Ç—Ä–æ–≥–∏–π –ö–∞—Ä–∞–Ω—Ç–∏–Ω: –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è —Å–µ–∫—Ç–æ—Ä–∞ —Å –≤–æ–æ—Ä—É–∂–µ–Ω–Ω–æ–π –æ—Ö—Ä–∞–Ω–æ–π. (–†–∏—Å–∫–æ–≤–∞–Ω–Ω–æ, –Ω–æ –¥–µ—à–µ–≤–æ)", cost: 10, effects: { trust: -25, prosperity: 0, stability: 30, freedom: -30 }, isOptimal: false },
                { id: 'B', text: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è: –û—Ç–∫—Ä—ã—Ç–æ –æ–±—ä—è—Å–Ω–∏—Ç—å —Ä–∏—Å–∫–∏ –∏ –ø—Ä–∏–∑–≤–∞—Ç—å –∫ —Å–∞–º–æ–∏–∑–æ–ª—è—Ü–∏–∏. (–ú–∞–∫—Å. –î–æ–≤–µ—Ä–∏–µ, –º–∏–Ω. –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å)", cost: 0, effects: { trust: 30, prosperity: -10, stability: -15, freedom: 15 }, isOptimal: false },
                { id: 'C', text: "–õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞—Ä–∞–∂–µ–Ω–Ω—ã–µ –¥–æ–º–∞. (–û–ø—Ç–∏–º–∞–ª—å–Ω–æ)", cost: 30, effects: { trust: 10, prosperity: 5, stability: 10, freedom: 0 }, isOptimal: true }, // –û–ü–¢–ò–ú–ê–õ–¨–ù–û - –î–û–†–û–ì–û
            ]
        },
        { // –ò–Ω–¥–µ–∫—Å 10 (–î–∏–ª–µ–º–º–∞ 9)
            id: "D10_JusticeReform",
            title: "–î–ò–õ–ï–ú–ú–ê 9: –°–£–î–ï–ë–ù–ê–Ø –†–ï–§–û–†–ú–ê",
            description: "–†–µ—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—É–¥–µ–±–Ω—É—é —Å–∏—Å—Ç–µ–º—É: —Å–¥–µ–ª–∞—Ç—å –µ–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–π –ò–ò (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å) –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å —Å—É–¥—ã –ø—Ä–∏—Å—è–∂–Ω—ã—Ö (—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å).",
            choices: [
                { id: 'A', text: "–ò–ò-–ø—Ä–∞–≤–æ—Å—É–¥–∏–µ: –í–≤–µ—Å—Ç–∏ –ò–ò –¥–ª—è 100% —Ä–µ—à–µ–Ω–∏–π. (–î–µ—à–µ–≤–æ, –Ω–æ —Ç–æ—Ç–∞–ª–∏—Ç–∞—Ä–Ω–æ)", cost: 10, effects: { trust: -5, prosperity: 20, stability: 20, freedom: -20 }, isOptimal: false },
                { id: 'B', text: "–°—É–¥—ã –ø—Ä–∏—Å—è–∂–Ω—ã—Ö: –û—Å—Ç–∞–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É, –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –æ–±—É—á–µ–Ω–∏–µ. (–û–ø—Ç–∏–º–∞–ª—å–Ω–æ)", cost: 28, effects: { trust: 25, prosperity: -15, stability: 0, freedom: 20 }, isOptimal: true }, // –û–ü–¢–ò–ú–ê–õ–¨–ù–û - –î–û–†–û–ì–û
                { id: 'C', text: "–°–∏—Å—Ç–µ–º–∞ –∞–ø–µ–ª–ª—è—Ü–∏–π: –û—Å—Ç–∞–≤–∏—Ç—å –ò–ò, –Ω–æ —Å–æ–∑–¥–∞—Ç—å –≥—Ä–∞–∂–¥–∞–Ω—Å–∫—É—é –∫–æ–º–∏—Å—Å–∏—é –ø–æ –∞–ø–µ–ª–ª—è—Ü–∏—è–º. (–°—Ä–µ–¥–Ω–∏–π –∫–æ–º–ø—Ä–æ–º–∏—Å—Å)", cost: 15, effects: { trust: 10, prosperity: 10, stability: 10, freedom: -5 }, isOptimal: false },
            ]
        },
        { // –ò–Ω–¥–µ–∫—Å 11 (–î–∏–ª–µ–º–º–∞ 10)
            id: "D11_FinalThreat",
            title: "–î–ò–õ–ï–ú–ú–ê 10: –ü–û–°–õ–ï–î–ù–Ø–Ø –£–ì–†–û–ó–ê",
            description: "–ö –≥–æ—Ä–æ–¥—É –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –æ–≥—Ä–æ–º–Ω—ã–π –∞—Å—Ç–µ—Ä–æ–∏–¥. –°—Ä–µ–¥—Å—Ç–≤–∞ –¥–ª—è –µ–≥–æ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è (–¥–æ—Ä–æ–≥–æ) –∏–ª–∏ –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ —Å–≤–µ—Ä—Ö–ø—Ä–æ—á–Ω–æ–≥–æ –±—É–Ω–∫–µ—Ä–∞ –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö (–æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ).",
            choices: [
                { id: 'A', text: "–£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –∞—Å—Ç–µ—Ä–æ–∏–¥–∞: –ó–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ —Ä–∞–∫–µ—Ç–Ω—É—é –æ–±–æ—Ä–æ–Ω—É. (–û–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è –≥–æ—Ä–æ–¥–∞)", cost: 35, effects: { trust: 30, prosperity: -30, stability: 15, freedom: 0 }, isOptimal: true }, // –û–ü–¢–ò–ú–ê–õ–¨–ù–û - –î–û–†–û–ì–û
                { id: 'B', text: "–ë—É–Ω–∫–µ—Ä –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª. (–°–∞–º—ã–π –¥–µ—à–µ–≤—ã–π, –Ω–æ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ –æ–±—â–µ—Å—Ç–≤–∞)", cost: 5, effects: { trust: -50, prosperity: 20, stability: 0, freedom: -40 }, isOptimal: false },
                { id: 'C', text: "–≠–≤–∞–∫—É–∞—Ü–∏—è: –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —ç–≤–∞–∫—É–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏–µ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ –∞–≤–∞–Ω–ø–æ—Å—Ç—ã. (–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞, –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫)", cost: 15, effects: { trust: 20, prosperity: -40, stability: -10, freedom: 10 }, isOptimal: false },
            ]
        }
    ];

    // --- –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø UI ---
    
    // –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–∏–¥–µ–æ
    function endIntroVideo() {
        if (introVideo) introVideo.style.display = 'none'; // –°–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –∏–Ω—Ç—Ä–æ-—ç–∫—Ä–∞–Ω–∞
        const introScreen = document.getElementById('intro-screen');
        introScreen.style.backgroundColor = '#121028'; // –í–µ—Ä–Ω—É—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç
        introScreen.classList.remove('opacity-0', 'pointer-events-none');
        introScreen.classList.add('opacity-100');
        document.getElementById('intro-lore').classList.remove('hidden');
        document.getElementById('main-title').classList.remove('hidden'); 
        if (startIntroButton) startIntroButton.classList.add('hidden'); // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ –ø–æ–∫–∞–∑–∞–Ω–∞
    }

    // üÜï –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ó–ê–ü–£–°–ö–ê –ú–ï–î–ò–ê –ü–û –ö–õ–ò–ö–£ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
    window.startVideoAndAudio = function() {
        if (startIntroButton) startIntroButton.classList.add('hidden');
        if (introVideo) introVideo.style.display = 'block';

        // 1. –ó–∞–ø—É—Å–∫ –∞—É–¥–∏–æ
        if (endingMusicAudio) {
            endingMusicAudio.play().catch(e => console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –º–µ–ª–æ–¥–∏–∏:", e));
        }

        // 2. –ó–∞–ø—É—Å–∫ –≤–∏–¥–µ–æ
        if (introVideo) {
             introVideo.play().catch(e => {
                 console.error("–í–∏–¥–µ–æ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –¥–∞–∂–µ –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.", e);
                 // –ï—Å–ª–∏ –≤–∏–¥–µ–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ª–æ—Ä—É
                 endIntroVideo(); 
             });
        }
    }

    window.animateDiamondUpdate = function() {
        const diamondCountSpan = document.getElementById('diamond-count');
        const diamondIcon = document.getElementById('diamond-icon');
       
        diamondCountSpan.classList.remove('diamond-flash');
        diamondIcon.classList.remove('diamond-flash');
       
        diamondCountSpan.classList.add('diamond-flash');
        diamondIcon.classList.add('diamond-flash');
       
        setTimeout(() => {
            diamondCountSpan.classList.remove('diamond-flash');
            diamondIcon.classList.remove('diamond-flash');
        }, 1000);
    }

    window.showGameContainer = function() {
        document.getElementById('intro-screen').classList.add('opacity-0', 'pointer-events-none');
        
        const gameContainer = document.getElementById('game-container');
        
        // üí´ –ó–ê–ü–£–°–ö –ê–ù–ò–ú–ê–¶–ò–ò: –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å—Ç–∞—Ä—Ç–∞
        gameContainer.classList.add('card-enter');

        setTimeout(() => {
            document.getElementById('intro-screen').classList.add('hidden');
            gameContainer.classList.remove('hidden');
            
            // üí´ –ó–ê–ü–£–°–ö –ê–ù–ò–ú–ê–¶–ò–ò: –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
            setTimeout(() => {
                gameContainer.classList.add('opacity-100', 'card-enter-active');
            }, 50);

        }, 500);
        document.body.classList.remove('p-4', 'md:p-8');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
   
    window.showMayorDataForm = function() {
        document.getElementById('intro-lore').classList.add('hidden');
        document.getElementById('mayor-data-form').classList.remove('hidden');
    }

    window.renderIntroScreen = function() {
        document.getElementById('game-container').classList.remove('opacity-100');
        document.getElementById('game-container').classList.add('hidden');
       
        // üí´ –°–ë–†–û–° –ê–ù–ò–ú–ê–¶–ò–ò: –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å—ã –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –∏–Ω—Ç—Ä–æ-—ç–∫—Ä–∞–Ω
        const gameContainer = document.getElementById('game-container');
        gameContainer.classList.remove('card-enter', 'card-enter-active', 'opacity-100');

        // 1. –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Å–∫—Ä—ã—Ç–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        const introScreen = document.getElementById('intro-screen');
        introScreen.classList.remove('hidden', 'opacity-0', 'pointer-events-none', 'opacity-100');
        introScreen.style.backgroundColor = '#000000'; // –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –≤–∏–¥–µ–æ
        document.getElementById('intro-lore').classList.add('hidden');
        document.getElementById('mayor-data-form').classList.add('hidden');
        document.getElementById('main-title').classList.add('hidden'); // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        
        // 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –º—ç—Ä–∞
        document.getElementById('mayor-name').value = "–ö–æ–ª–æ–Ω–∏—Å—Ç 101";
        document.getElementById('mayor-age').value = "35";
        document.getElementById('mayor-gender').value = "–ù–µ —É–∫–∞–∑–∞–Ω";
        
        // 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞
        if (backgroundTensionAudio) backgroundTensionAudio.pause();
        if (endingMusicAudio) {
            endingMusicAudio.volume = 0.5;
        }
        
        // üÜï –°–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ-–∫–æ–Ω—Ü–æ–≤–∫–∏
        videoGoodEnding.style.display = 'none';
        videoBadEnding.style.display = 'none';
        videoGoodEnding.pause();
        videoBadEnding.pause();
        
        if (introVideo) {
            introVideo.style.display = 'block';
            introVideo.currentTime = 0; // –ù–∞—á–∞—Ç—å —Å –Ω–∞—á–∞–ª–∞
            
            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ (–ø–µ—Ä–≤—ã–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π, –∑–∞–ø—É—Å–∫)
            Promise.all([introVideo.play(), endingMusicAudio.play()])
                .then(() => {
                    // –£—Å–ø–µ—Ö: –í–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ –∏–≥—Ä–∞—é—Ç, –∫–Ω–æ–ø–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞
                    console.log("–í–∏–¥–µ–æ –∏ –∞—É–¥–∏–æ –∑–∞–ø—É—â–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.");
                })
                .catch(error => {
                    // –ü—Ä–æ–≤–∞–ª: –ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É.
                    console.warn("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ. –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–Ω–æ–ø–∫—É.", error);
                    introVideo.style.display = 'none';
                    if (endingMusicAudio) endingMusicAudio.pause(); // –û—Å—Ç–∞–≤–ª—è–µ–º –º—É–∑—ã–∫—É –≤ –ø–æ–∫–æ–µ
                    if (startIntroButton) startIntroButton.classList.remove('hidden');
                });

            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ –≤–∏–¥–µ–æ
            introVideo.onended = endIntroVideo;
        } else {
             // –ï—Å–ª–∏ —Ç–µ–≥ –≤–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ä–∞–∑—É
             endIntroVideo();
        }
    }

    window.updateStatsUI = function() {
        const diamondSpan = document.getElementById('diamond-count');
        const currentDiamondsDisplay = document.getElementById('current-diamonds');
       
        if (diamondSpan) {
            diamondSpan.textContent = GAME_STATE.diamonds;
        }
        if (currentDiamondsDisplay) {
            currentDiamondsDisplay.textContent = GAME_STATE.diamonds;
        }
       
        STATS.forEach(stat => {
            const bar = document.getElementById(`bar-${stat}`);
            if (bar) {
                const value = Math.max(0, Math.min(100, GAME_STATE[stat]));
                bar.style.width = `${value}%`;
               
                let colorVar = '';
                if (stat === 'trust') colorVar = '--color-trust';
                else if (stat === 'prosperity') colorVar = '--color-prosperity';
                else if (stat === 'stability') colorVar = '--color-stability';
                else if (stat === 'freedom') colorVar = '--color-freedom';
               
                let color;
                if (value < 20) color = '#ef4444';
                else if (value < 50) color = '#facc15';
                else color = `var(${colorVar})`;
               
                bar.style.backgroundColor = color;
            }
        });

        const stageMap = {
            0: "–í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö",
            1: "–í—ã–±–æ—Ä –ò–¥–µ–æ–ª–æ–≥–∏–∏",
            2: "–ì–ª–∞–≤–∞ 1: –ö—Ä–∏–∑–∏—Å ‚Ññ1",
            3: "–ì–ª–∞–≤–∞ 2: –ö—Ä–∏–∑–∏—Å ‚Ññ2",
            4: "–ì–ª–∞–≤–∞ 3: –ö—Ä–∏–∑–∏—Å ‚Ññ3",
            5: "–ì–ª–∞–≤–∞ 4: –ö—Ä–∏–∑–∏—Å ‚Ññ4",
            6: "–ì–ª–∞–≤–∞ 5: –ö—Ä–∏–∑–∏—Å ‚Ññ5",
            7: "–ì–ª–∞–≤–∞ 6: –ö—Ä–∏–∑–∏—Å ‚Ññ6",
            8: "–ì–ª–∞–≤–∞ 7: –ö—Ä–∏–∑–∏—Å ‚Ññ7",
            9: "–ì–ª–∞–≤–∞ 8: –ö—Ä–∏–∑–∏—Å ‚Ññ8",
            10: "–ì–ª–∞–≤–∞ 9: –ö—Ä–∏–∑–∏—Å ‚Ññ9",
            11: "–ì–ª–∞–≤–∞ 10: –ü–æ—Å–ª–µ–¥–Ω–∏–π –ö—Ä–∏–∑–∏—Å",
        };
        document.getElementById('game-stage').textContent = `–≠—Ç–∞–ø: ${stageMap[GAME_STATE.dilemmaIndex] || "–ö–æ–Ω–µ—Ü –ò–≥—Ä—ã"}`;
    }
   
    window.showModal = function(title, message, isFailure = false) {
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-message').innerHTML = message;
       
        const closeButton = document.getElementById('modal-close-button');
       
        if (isFailure) {
            closeButton.textContent = '–û—Å–æ–∑–Ω–∞—Ç—å –ü–æ—Ä–∞–∂–µ–Ω–∏–µ';
            closeButton.onclick = () => {
                closeModal();
                const choices = document.getElementById('choices-container');
                const content = document.getElementById('main-content');
                if (choices) choices.innerHTML = '';
               
                // 1. –ó–∞–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω –ø–æ—Ä–∞–∂–µ–Ω–∏—è (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
                content.innerHTML = `<h2 class="text-4xl font-extrabold text-red-500 mb-6 text-center">–ü–û–†–¢–ê–õ –°–£–î–¨–ë–´ –ó–ê–ö–†–´–¢</h2>
                    <p class="text-center text-xl font-bold text-gray-400 mt-10">
                        –ú—ç—Ä ${GAME_STATE.mayorName}, –≤–∞—à–∏ –ë—Ä–∏–ª–ª–∏–∞–Ω—Ç—ã –í–ª–∞—Å—Ç–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã.
                    </p>
                    <p class="text-center text-lg text-gray-300 mt-4">
                        –ù–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–µ–ª–∞ –∫ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ–º—É –∫—Ä–∞—Ö—É.
                        –ù—É—Ä–∏–∞–¥ –Ω–µ —Å–º–æ–≥ –ø–µ—Ä–µ–∂–∏—Ç—å —ç—Ç–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ.
                    </p>
                    <p class="text-center text-sm text-gray-500 mt-10">
                        –ù–∞–∂–º–∏—Ç–µ **"–ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞"** –≤–≤–µ—Ä—Ö—É, —á—Ç–æ–±—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞.
                    </p>`;
                
                // 2. üîä –û–°–¢–ê–ù–û–í–ò–¢–¨ –¢–ò–ö–ê–ù–¨–ï –ò –ó–ê–ü–£–°–¢–ò–¢–¨ –§–ò–ù–ê–õ–¨–ù–£–Æ –ú–£–ó–´–ö–£
                if (backgroundTensionAudio) backgroundTensionAudio.pause(); 
                if (endingMusicAudio) {
                    endingMusicAudio.volume = 0.5;
                    endingMusicAudio.play().catch(e => console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –º–µ–ª–æ–¥–∏–∏:", e));
                }
                if (startIntroButton) startIntroButton.classList.add('hidden'); // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É

                // 3. üé• –ó–ê–ü–£–°–ö –ü–õ–û–•–û–ô –ö–û–ù–¶–û–í–ö–ò
                document.getElementById('game-container').classList.add('hidden'); // –°–∫—Ä—ã—Ç—å –∏–≥—Ä—É
                
                setTimeout(() => {
                    if (videoBadEnding) {
                        videoBadEnding.style.display = 'block';
                        videoBadEnding.currentTime = 0;
                        videoBadEnding.play().catch(e => console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø–ª–æ—Ö–æ–≥–æ –≤–∏–¥–µ–æ:", e));
                        
                        // –°–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ, –∫–æ–≥–¥–∞ –æ–Ω–æ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è, –∏ –ø–æ–∫–∞–∑–∞—Ç—å –∏–≥—Ä—É —Å —Ñ–∏–Ω–∞–ª—å–Ω—ã–º —ç–∫—Ä–∞–Ω–æ–º
                        videoBadEnding.onended = () => {
                             videoBadEnding.style.display = 'none';
                             document.getElementById('game-container').classList.remove('hidden');
                        };
                    } else {
                         document.getElementById('game-container').classList.remove('hidden');
                    }
                }, 4000); // 4-—Å–µ–∫—É–Ω–¥–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
                
                // üÜï 5. –ó–ê–ü–ò–°–¨ –ü–û–†–ê–ñ–ï–ù–ò–Ø –í –ë–î
                saveData('final_results', {
                    final_trust: GAME_STATE.trust,
                    final_prosperity: GAME_STATE.prosperity,
                    final_stability: GAME_STATE.stability,
                    final_freedom: GAME_STATE.freedom,
                    ending_type: 'Failure',
                    total_decisions: GAME_STATE.decisionCount,
                    expensive_choices: GAME_STATE.expensiveChoices,
                    bonuses_received: GAME_STATE.bonusesReceived,
                });
            };
        } else {
            closeButton.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
            closeButton.onclick = () => {
                closeModal();
                updateUIBasedOnState();
            };
        }

        document.getElementById('modal').classList.remove('hidden');
        document.getElementById('modal').classList.add('flex');
    }

    window.closeModal = function() {
        document.getElementById('modal').classList.add('hidden');
        document.getElementById('modal').classList.remove('flex');
    }

    function updateUIBasedOnState() {
       
        if (GAME_STATE.dilemmaIndex <= 1) {
            if (GAME_STATE.dilemmaIndex === 0) renderIntroScreen();
            else if (GAME_STATE.dilemmaIndex === 1) renderMayorSelection(true);
            return;
        }

        showGameContainer();
        updateStatsUI();
       
        // Show all stats on mobile too
        STATS.forEach(stat => {
            const element = document.getElementById(`stat-${stat}`);
            if (element) {
                element.classList.remove('hidden');
            }
        });
       
        const currentDilemma = DILEMMAS[GAME_STATE.dilemmaIndex];
       
        if (currentDilemma && GAME_STATE.dilemmaIndex >= 2 && GAME_STATE.dilemmaIndex <= 11) {
            renderDilemma(currentDilemma);
            if (endingMusicAudio) endingMusicAudio.pause(); // –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º—É–∑—ã–∫–∞ –∫–æ–Ω—Ü–æ–≤–∫–∏ –≤—ã–∫–ª—é—á–µ–Ω–∞ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã
        } else {
            // üèÜ –≠–ö–†–ê–ù –ü–û–ë–ï–î–´
            
            // 1. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
            const finalReport = STATS.map(stat => {
                const value = GAME_STATE[stat];
                const color = value > 75 ? 'text-green-400' : (value > 40 ? 'text-yellow-400' : 'text-red-400');
                const statName = stat.charAt(0).toUpperCase() + stat.slice(1);
                
                let message;
                if (stat === 'trust') message = value > 75 ? "–ù–∞—Ä–æ–¥ –≤–µ—Ä–∏—Ç –≤ –≤–∞—Å –∏ –±—É–¥—É—â–µ–µ –∫–æ–ª–æ–Ω–∏–∏." : value > 40 ? "–î–æ–≤–µ—Ä–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –Ω–æ –µ—Å—Ç—å –Ω–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ." : "–ú–∞—Å—Å–æ–≤—ã–µ –ø—Ä–æ—Ç–µ—Å—Ç—ã –∏ –Ω–µ–¥–æ–≤–µ—Ä–∏–µ –∫ –≤–ª–∞—Å—Ç–∏.";
                else if (stat === 'prosperity') message = value > 75 ? "–ì–æ—Ä–æ–¥ –ø—Ä–æ—Ü–≤–µ—Ç–∞–µ—Ç, —Ä–µ—Å—É—Ä—Å—ã –≤ –∏–∑–±—ã—Ç–∫–µ." : value > 40 ? "–≠–∫–æ–Ω–æ–º–∏–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞, –Ω–æ –Ω—É–∂–Ω—ã –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏." : "–ì–æ–ª–æ–¥ –∏ –¥–µ—Ñ–∏—Ü–∏—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤.";
                else if (stat === 'stability') message = value > 75 ? "–ü–æ—Ä—è–¥–æ–∫ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –≤—ã—Å–æ—á–∞–π—à–µ–º —É—Ä–æ–≤–Ω–µ." : value > 40 ? "–°–∏—Ç—É–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞, –Ω–æ –µ—Å—Ç—å –æ—á–∞–≥–∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è." : "–ö—Ä–∏–º–∏–Ω–∞–ª –∏ –∞–Ω–∞—Ä—Ö–∏—è –∑–∞—Ö–≤–∞—Ç–∏–ª–∏ —Å–µ–∫—Ç–æ—Ä—ã.";
                else if (stat === 'freedom') message = value > 75 ? "–ö–æ–ª–æ–Ω–∏—è –∂–∏–≤–µ—Ç –≤ —É—Å–ª–æ–≤–∏—è—Ö –ø–æ–ª–Ω–æ–π –¥–µ–º–æ–∫—Ä–∞—Ç–∏–∏." : value > 40 ? "–°–≤–æ–±–æ–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ —Ä–∞–¥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏." : "–¢–æ—Ç–∞–ª–∏—Ç–∞—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∫–∞–∂–¥—ã–º –∞—Å–ø–µ–∫—Ç–æ–º –∂–∏–∑–Ω–∏.";
                
                return `<div class="card p-3 rounded-lg flex justify-between items-center mb-2">
                            <span class="font-bold text-lg ${color}">${statName.toUpperCase()}: ${value}%</span>
                            <span class="text-sm text-gray-400 ml-4">${message}</span>
                        </div>`;
            }).join('');

            const content = document.getElementById('main-content');
            content.innerHTML = `<h2 class="text-4xl font-extrabold text-green-400 mb-6 text-center">–ú–ò–°–°–ò–Ø –í–´–ü–û–õ–ù–ï–ù–ê!</h2>
                <p class="text-center text-xl font-bold text-gray-400 mt-10">
                    –ú—ç—Ä ${GAME_STATE.mayorName}, –≤—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–≤–µ–ª–∏ –ù—É—Ä–∏–∞–¥ —á–µ—Ä–µ–∑ 10 —Å–ª–æ–∂–Ω–µ–π—à–∏—Ö –∫—Ä–∏–∑–∏—Å–æ–≤.
                </p>
                <h3 class="text-3xl font-semibold text-indigo-300 my-6 text-center">–§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ –ù–£–†–ò–ê–î–ê:</h3>
                <div class="space-y-4">${finalReport}</div>
                <p class="text-center text-lg text-gray-300 mt-8">
                    –í–∞—à–µ –Ω–∞—Å–ª–µ–¥–∏–µ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ —ç—Ç–∏–º –±–∞–ª–∞–Ω—Å–æ–º.
                </p>
                <p class="text-center text-sm text-gray-500 mt-10">–ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞" —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ù—É—Ä–∏–∞–¥–∞.</p>`;
            
            // 2. üîä –û–°–¢–ê–ù–û–í–ò–¢–¨ –¢–ò–ö–ê–ù–¨–ï –ò –ó–ê–ü–£–°–¢–ò–¢–¨ –§–ò–ù–ê–õ–¨–ù–£–Æ –ú–£–ó–´–ö–£
            if (backgroundTensionAudio) backgroundTensionAudio.pause();
            if (endingMusicAudio) {
                endingMusicAudio.volume = 0.5;
                endingMusicAudio.play().catch(e => console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –º–µ–ª–æ–¥–∏–∏:", e));
            }
            
            // 3. üé• –ó–ê–ü–£–°–ö –•–û–†–û–®–ï–ô/–ü–õ–û–•–û–ô –ö–û–ù–¶–û–í–ö–ò (—á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã)
            document.getElementById('game-container').classList.add('hidden'); // –°–∫—Ä—ã—Ç—å –∏–≥—Ä—É
            
            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, –∫–∞–∫—É—é –∫–æ–Ω—Ü–æ–≤–∫—É –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
            // üÜï –ù–æ–≤–æ–µ —É—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ –±—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å > 0, —Ç–æ —É—Å–ø–µ—Ö. –ò–Ω–∞—á–µ - –Ω–µ—É–¥–∞—á–∞.
            const allStatsHigh = GAME_STATE.diamonds > 0;
            const videoToPlay = allStatsHigh ? videoGoodEnding : videoBadEnding; 
            const endingType = allStatsHigh ? 'Success' : 'Failure';

            setTimeout(() => {
                if (videoToPlay) {
                    videoToPlay.style.display = 'block';
                    videoToPlay.currentTime = 0;
                    videoToPlay.play().catch(e => console.error(`–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –≤–∏–¥–µ–æ (${endingType} Ending):`, e));
                    
                    // –°–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ, –∫–æ–≥–¥–∞ –æ–Ω–æ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è, –∏ –ø–æ–∫–∞–∑–∞—Ç—å –∏–≥—Ä—É —Å —Ñ–∏–Ω–∞–ª—å–Ω—ã–º —ç–∫—Ä–∞–Ω–æ–º
                    videoToPlay.onended = () => {
                        videoToPlay.style.display = 'none';
                        document.getElementById('game-container').classList.remove('hidden');
                    };
                } else {
                    document.getElementById('game-container').classList.remove('hidden');
                }
            }, 4000); // 4-—Å–µ–∫—É–Ω–¥–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
            
            // 4. –ó–ê–ü–ò–°–¨ –§–ò–ù–ê–õ–¨–ù–´–• –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –í –ë–î
            saveData('final_results', {
                final_trust: GAME_STATE.trust,
                final_prosperity: GAME_STATE.prosperity,
                final_stability: GAME_STATE.stability,
                final_freedom: GAME_STATE.freedom,
                ending_type: endingType,
                total_decisions: GAME_STATE.decisionCount,
                expensive_choices: GAME_STATE.expensiveChoices,
                bonuses_received: GAME_STATE.bonusesReceived,
            });
        }
    }

    // --- –§–£–ù–ö–¶–ò–ò –ò–ì–†–û–í–û–ô –õ–û–ì–ò–ö–ò ---

    window.startSelection = async function() {
        const nameInput = document.getElementById('mayor-name');
        const ageInput = document.getElementById('mayor-age');
        const genderInput = document.getElementById('mayor-gender');

        if (!nameInput.value || !ageInput.value) {
            showModal("–û—à–∏–±–∫–∞ –≤–≤–æ–¥–∞", "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è –∏ –≤–æ–∑—Ä–∞—Å—Ç –¥–ª—è –ú—ç—Ä–∞.");
            return;
        }
       
        // –§–∏–∫—Å–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ú—ç—Ä–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ –≤—ã–±–æ—Ä—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
        GAME_STATE.mayorName = nameInput.value;
        GAME_STATE.mayorAge = parseInt(ageInput.value, 10);
        GAME_STATE.mayorGender = genderInput.value;
        GAME_STATE.dilemmaIndex = 1;
        await saveGameState();
       
        renderMayorSelection(false);
    }

    window.renderMayorSelection = function(isLoad = false) {
        if (!isLoad) showGameContainer();
       
        GAME_STATE.dilemmaIndex = 1;
        updateStatsUI();
        const content = document.getElementById('main-content');
       
        STATS.forEach(stat => document.getElementById(`stat-${stat}`).classList.remove('hidden'));

        content.innerHTML = `
            <h2 class="text-3xl font-semibold mb-4 text-center text-indigo-300">–®–ê–ì 2: –í—ã–±–µ—Ä–∏—Ç–µ –ò–¥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –ü–ª–∞—Ç—Ñ–æ—Ä–º—É</h2>
            <p class="dim-text mb-2 text-center">–í—ã: **${GAME_STATE.mayorName}**, ${GAME_STATE.mayorAge} –ª–µ—Ç, –ø–æ–ª: ${GAME_STATE.mayorGender}.</p>
            <p class="dim-text mb-8 text-center">–í–∞—à–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.</p>
           
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
                ${renderPlatformCard('–ì—É–º–∞–Ω–∏–∑–º')}
                ${renderPlatformCard('–ê–≤—Ç–æ—Ä–∏—Ç–∞—Ä–∏–∑–º')}
                ${renderPlatformCard('–¢–µ—Ö–Ω–æ–∫—Ä–∞—Ç–∏—è')}
            </div>
        `;
    }

    function renderPlatformCard(ideology) {
        const platform = MAYOR_PLATFORMS[ideology];
        const bonusText = `+${Object.values(platform.bonus)[0]}% –∫ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º—É ${Object.keys(platform.bonus)[0].toUpperCase()}`;
       
        return `
            <div class="card p-5 rounded-xl text-center flex flex-col items-center">
                <img src="${platform.image}" alt="${platform.name}" class="mayor-avatar mb-3" onerror="this.onerror=null;this.src='https://placehold.co/100x100/1e1b3d/ffffff?text=${ideology.substring(0, 2)}';" />
                <h3 class="text-2xl font-bold text-indigo-400 mb-2">${platform.name}</h3>
                <p class="text-sm font-semibold mb-3 text-cyan-400">${ideology}</p>
               
                <div class="text-sm space-y-2 mb-6 w-full p-3 rounded-lg bg-gray-800/50">
                    <p class="text-green-400 font-bold">${bonusText}</p>
                    <p class="text-red-400">${platform.malus}</p>
                </div>
               
                <button onclick="selectMayor('${ideology}')"
                        class="px-4 py-3 w-full bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-semibold mt-auto shadow-md min-h-[44px]">
                    –í—ã–±—Ä–∞—Ç—å
                </button>
            </div>
        `;
    }

    window.selectMayor = async function(ideology) {
        const savedPlayerState = {
            mayorName: GAME_STATE.mayorName,
            mayorAge: GAME_STATE.mayorAge,
            mayorGender: GAME_STATE.mayorGender,
        };
       
        // –°–±—Ä–æ—Å –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
        GAME_STATE = {
            ...DEFAULT_GAME_STATE,
            ...savedPlayerState
        };

        GAME_STATE.mayorIdeology = ideology;

        const platform = MAYOR_PLATFORMS[ideology];
        for (const stat in platform.bonus) {
            GAME_STATE[stat] = Math.max(0, Math.min(100, GAME_STATE[stat] + platform.bonus[stat]));
        }

        if (ideology === '–ê–≤—Ç–æ—Ä–∏—Ç–∞—Ä–∏–∑–º') {
            GAME_STATE.freedom = Math.max(0, GAME_STATE.freedom - 15);
        }

        // üÜï –ó–ê–ü–ò–°–¨ –ü–û–õ–ù–´–• –î–ê–ù–ù–´–• –ò–ì–†–û–ö–ê –í –ë–î
        saveData('players', {
            player_name: GAME_STATE.mayorName,
            player_age: GAME_STATE.mayorAge,
            player_gender: GAME_STATE.mayorGender,
            mayor_choice: GAME_STATE.mayorIdeology
        });

        // üîä –ó–ê–ü–£–°–ö –¢–ò–ö–ê–Æ–©–ï–ì–û –ó–í–£–ö–ê (–ù–ê–ü–†–Ø–ñ–ï–ù–ò–ï)
        if (endingMusicAudio) endingMusicAudio.pause();
        if (backgroundTensionAudio) {
            backgroundTensionAudio.volume = 0.4; // –ì—Ä–æ–º–∫–æ—Å—Ç—å 40%
            backgroundTensionAudio.play().catch(error => {
                console.warn("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ. –ù–∞–∂–º–∏—Ç–µ '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å'.", error);
            });
        }
        // –°–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ, –µ—Å–ª–∏ –æ–Ω–æ –µ—â–µ –∞–∫—Ç–∏–≤–Ω–æ
        if (introVideo) introVideo.style.display = 'none';
        if (startIntroButton) startIntroButton.classList.add('hidden');

        GAME_STATE.dilemmaIndex = 2;
        await saveGameState();
        updateUIBasedOnState();
    }

    function renderDilemma(dilemma) {
        updateStatsUI();
       
        const content = document.getElementById('main-content');
        const mayorInfo = `–ú—ç—Ä ${GAME_STATE.mayorName} (${GAME_STATE.mayorIdeology})`;

        STATS.forEach(stat => document.getElementById(`stat-${stat}`).classList.remove('hidden'));
       
        content.innerHTML = `
            <div class="card p-6 rounded-xl mb-8 bg-gradient-nuriad">
                <h2 class="text-3xl font-bold text-red-300 mb-3">${dilemma.title}</h2>
                <p class="text-gray-300 text-lg mb-4">${dilemma.description}</p>
            </div>
           
            <h3 class="text-2xl font-semibold mb-4 text-indigo-300 flex items-center">
                –í–∞—à –≤—ã–±–æ—Ä, ${mayorInfo} (
                <span class="text-lg font-bold flex items-center inline-block ml-1">
                    <img id="diamond-icon" src="assets/images/diamond_icon.png" alt="Diamond" class="w-5 h-5 mr-1" />
                    <span style="color: var(--color-diamond)" id="current-diamonds">${GAME_STATE.diamonds}</span>
                </span>
                –ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤)
            </h3>
            <div id="choices-container" class="space-y-4">
                ${dilemma.choices.map((choice, index) => {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º cost –∏–∑ –≤—ã–±–æ—Ä–∞, –∞ –Ω–µ –∏–∑ –¥–∏–ª–µ–º–º—ã
                    const cost = calculateCost(choice.cost);
                    const isAffordable = GAME_STATE.diamonds >= cost;
                    const buttonClass = isAffordable
                        ? 'bg-gray-700/50 hover:bg-gray-600/70 border border-gray-600'
                        : 'bg-gray-800/50 border border-gray-700 cursor-not-allowed opacity-50';
                    const onclickAction = isAffordable
                        ? `makeDecision('${dilemma.id}', ${index}, ${cost})`
                        : `handleFailure(${cost})`;
                   
                    const optimalTag = choice.isOptimal ? '<span class="text-green-400 text-xs ml-2">[+5 –ë–û–ù–£–°]</span>' : '';

                    return `
                        <button
                            onclick="${onclickAction}"
                            class="btn-choice w-full text-left p-4 rounded-xl ${buttonClass} flex justify-between items-start shadow-lg"
                        >
                            <span class="flex-grow pr-4">${choice.text} ${optimalTag}</span>
                            <span class="text-cyan-400 font-bold ml-4 whitespace-nowrap text-lg flex items-center">
                                (${cost} <span class="text-base ml-1">–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤</span>)
                            </span>
                        </button>
                    `;
                }).join('')}
            </div>
        `;
    }
   
    // üíÄ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ë–†–ê–ë–û–¢–ö–ò –ü–û–†–ê–ñ–ï–ù–ò–Ø
    window.handleFailure = function(requiredCost) {
        showModal(
            '‚ö†Ô∏è –ü–†–û–í–ê–õ –ú–ò–°–°–ò–ò: –ë–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–æ –ù—É—Ä–∏–∞–¥–∞!',
            `–£ –≤–∞—Å **–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤ –í–ª–∞—Å—Ç–∏** (—Ç—Ä–µ–±—É–µ—Ç—Å—è: ${requiredCost}) –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —ç—Ç–æ–≥–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è. –†–µ—Å—É—Ä—Å—ã –∏—Å—á–µ—Ä–ø–∞–Ω—ã, –∏ –≥–æ—Ä–æ–¥ –ø–æ–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ —Ö–∞–æ—Å.
            <br><br>
            **–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.** –í—ã –Ω–µ —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å —Å –ë—Ä–µ–º–µ–Ω–µ–º –ú—ç—Ä–∞.
            
            <p class="text-xs text-red-300 mt-4">
                –ö—Ä–∞—Ö –ø—Ä–æ–∏–∑–æ—à–µ–ª –Ω–∞ —ç—Ç–∞–ø–µ **${DILEMMAS[GAME_STATE.dilemmaIndex].title}**
            </p>
            `, 
            true // –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —ç—Ç–æ —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ—Ä–∞–∂–µ–Ω–∏—è
        );
    }
   
    /**
     * –í—ã—á–∏—Å–ª—è–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞, —É—á–∏—Ç—ã–≤–∞—è —à—Ç—Ä–∞—Ñ –ì—É–º–∞–Ω–∏–∑–º–∞.
     * @param {number} baseCost - –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å, —É–∫–∞–∑–∞–Ω–Ω–∞—è –≤ 'choice.cost'.
     */
    function calculateCost(baseCost) {
        let cost = baseCost;
        if (GAME_STATE.mayorIdeology === '–ì—É–º–∞–Ω–∏–∑–º') {
            cost = Math.ceil(cost * EXPENSIVE_COST_MULTIPLIER);
        }
        return cost;
    }

    /**
     * –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—à–µ–Ω–∏—è, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π –¥–∏–ª–µ–º–º–µ.
     */
    window.makeDecision = async function(dilemmaId, choiceIndex, cost) {
        isUpdatingUI = true;
       
        const dilemma = DILEMMAS[GAME_STATE.dilemmaIndex];
        const choice = dilemma.choices[choiceIndex];
       
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –î–û
        const statsBefore = {
            trust_before: GAME_STATE.trust,
            prosperity_before: GAME_STATE.prosperity,
            stability_before: GAME_STATE.stability,
            freedom_before: GAME_STATE.freedom
        };
        const diamondsBefore = GAME_STATE.diamonds;
       
        const oldDiamonds = GAME_STATE.diamonds;

        if (oldDiamonds < cost) {
            handleFailure(cost);
            isUpdatingUI = false;
            return;
        }

        // 1. –í—ã—á–∏—Ç–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
        GAME_STATE.diamonds -= cost;
       
        // 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞ –∑–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä
        let bonus = 0;
        if (choice.isOptimal) {
            bonus = OPTIMAL_BONUS;
            GAME_STATE.diamonds += bonus;
            GAME_STATE.bonusesReceived++;
        }
        
        // üÜï –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–æ—Ä–æ–≥–∏—Ö –≤—ã–±–æ—Ä–æ–≤
        if (cost > 20) {
             GAME_STATE.expensiveChoices++;
        }
       
        window.updateStatsUI();
        animateDiamondUpdate();

        let resultsMessage = "";
        const effectsApplied = {};
        for (const stat in choice.effects) {
            let effectValue = choice.effects[stat];
           
            // –®—Ç—Ä–∞—Ñ –¢–µ—Ö–Ω–æ–∫—Ä–∞—Ç–∏–∏ –Ω–∞ –î–æ–≤–µ—Ä–∏–µ
            if (stat === 'trust' && effectValue > 0 && GAME_STATE.mayorIdeology === '–¢–µ—Ö–Ω–æ–∫—Ä–∞—Ç–∏—è') {
                effectValue = Math.ceil(effectValue * SLOW_TRUST_MULTIPLIER);
            }
           
            GAME_STATE[stat] = Math.max(0, Math.min(100, GAME_STATE[stat] + effectValue));
            effectsApplied[stat] = effectValue;
           
            const sign = effectValue > 0 ? '+' : '';
            const color = effectValue > 0 ? 'text-green-400' : (effectValue < 0 ? 'text-red-400' : 'text-gray-400');
            const statName = stat.charAt(0).toUpperCase() + stat.slice(1);
            resultsMessage += `<p class="flex justify-between items-center text-sm"><span class="font-bold">${statName.toUpperCase()}:</span> <span class="${color}">${sign}${effectValue}</span></p>`;
        }
       
        // üÜï 3. –ó–ê–ü–ò–°–¨ –†–ï–®–ï–ù–ò–Ø –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ò –í –ë–î
        GAME_STATE.decisionCount++;
        
        // –ó–∞–ø–∏—Å—å –≤ decisions
        saveData('decisions', {
             dilemma_id: dilemma.id,
             chapter: dilemma.title,
             choice_index: choice.id,
             choice_cost: cost,
             diamonds_before: diamondsBefore,
             diamonds_after: GAME_STATE.diamonds,
             choice_text: choice.text,
             is_optimal: choice.isOptimal
        });

        // –ó–∞–ø–∏—Å—å –≤ society_stats
        saveData('society_stats', {
            dilemma_id: dilemma.id,
            trust_before: statsBefore.trust_before,
            prosperity_before: statsBefore.prosperity_before,
            stability_before: statsBefore.stability_before,
            freedom_before: statsBefore.freedom_before,
            trust_after: GAME_STATE.trust,
            prosperity_after: GAME_STATE.prosperity,
            stability_after: GAME_STATE.stability,
            freedom_after: GAME_STATE.freedom,
        });
       
        // 4. –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É
        GAME_STATE.dilemmaIndex += 1;
        await saveGameState();

        setTimeout(() => {
            const diamondChange = bonus > 0 ? ` (+${bonus} –ë. –∑–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ—Å—Ç—å)` : '';
            const bonusText = bonus > 0 ? `<p class="text-sm font-semibold text-green-400 mt-2">–í—ã–±–æ—Ä –±—ã–ª **–û–ü–¢–ò–ú–ê–õ–¨–ù–´–ú**! –ü–æ–ª—É—á–µ–Ω–æ +${bonus} –ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤.</p>` : '';

            const modalContent = `
                <div class="text-left">
                    <p class="mb-4 text-gray-300">–í—ã –≤—ã–±—Ä–∞–ª–∏: **${choice.text.split(':')[0]}**.</p>
                    <div class="card p-4 rounded-lg mb-4 bg-gray-800/50">
                        <p class="text-lg font-bold text-red-400 mb-2">–ó–∞—Ç—Ä–∞—Ç—ã: ${cost} <span class="text-cyan-400">–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤</span></p>
                        ${bonusText}
                        <p class="text-sm text-cyan-400">–û—Å—Ç–∞—Ç–æ–∫: ${GAME_STATE.diamonds}</p>
                    </div>
                    <h4 class="text-lg font-semibold text-indigo-300 mb-2">–ò–∑–º–µ–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫:</h4>
                    <div class="space-y-1">${resultsMessage}</div>
                </div>
            `;

            showModal("–†–ï–®–ï–ù–ò–ï –ü–†–ò–ù–Ø–¢–û", modalContent);
            isUpdatingUI = false;
        }, 1000);
    }

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´ ---

    function initialize() {
        const splash = document.getElementById('splash-screen');

        setTimeout(() => {
            splash.style.opacity = '0';
           
            setTimeout(() => {
                splash.style.display = 'none';
                updateUIBasedOnState(); // –ó–∞–ø—É—Å—Ç–∏—Ç renderIntroScreen
               
            }, 1500);
        }, 1000);
       
        document.addEventListener('DOMContentLoaded', updateStatsUI);
    }
   
    initialize();
</script>
</body>
</html>